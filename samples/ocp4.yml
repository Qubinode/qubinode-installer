---
########################
#     MAIN
# These are the vars that
# you are most
# likely to change.
#########################

# This should be updated if you delete the kubeadmin user
# You will need to setup a kubeconfig for the cluster admin
# user.
ocp_cluster_admin_kubeconfig: "{{ openshift_install_dir }}/auth/kubeconfig"

# Default cluster id
cluster_name: qub388

# Sub domain for your cluster
ocp4_subdomain: cloud

# Set to true to enable fips
cluster_fips_aware: false

# Set this to the y-stream release you want deployed
# You can view releases here https://openshift-release.apps.ci.l2s4.p1.openshiftapps.com/
ocp4_ystream_release: 4.9

# The installer can auto populate the below vars
# which the latest version number that matches the y-stream. 
# Set this to "no" if you want to deploy a older versions of
# the y-stream.
auto_get_releases: yes

# These values will be populated when "auto_get_releases" is set to yes.
# They define the openshift rhcos images and installer that needs to be 
# downloaded.

#TODO: the vars need update to clealy indicate what they
# actually do
ocp4_release: "{{ ocp4_user_wanted_release | default(ocp4_auto_updated_release) }}"
ocp4_image: "{{ ocp4_release }}"
ocp4_image_version: "{{ ocp4_image }}"
ocp4_dependencies_version: "{{ ocp4_ystream_release }}"
ocp4_client_version: "{{ ocp4_release }}"

# Set to yes to configure OCP built in registry
configure_registry: no

# The default PV for the registry
registry_pvc_size: 100Gi

# Three is the minimum supported 
# for the Control plane
ctrlplane_count: 3

# Control plane node sizes
ctrlplane_hd_size: 120
ctrlplane_mem_size: 32384
ctrlplane_vcpu: 4
ctrlplane_vdb_size: 10G
ctrlplane_vdc_size: 50G

# This tells the installer how many RHCOS worker vms to deploy
# Set this to zero to get a three-node cluster.
compute_count: 2

# Compute node sizes
compute_hd_size: 120
compute_mem_size: 32384
compute_vcpu: 2
compute_vdb_size: 60
compute_vdc_size: 60

# Tells the installer not to deploy sparse qcow for
# the computes extra disk
performance_disk: no

# set to true to uninstall the cluster
tear_down: false

##########################
#     DEFAULTS           #
# You should only change #
# these if you know what #
# you are doing          #
##########################

###########################################
# openshift-install Ignitions and Manifests
# 
local_user_account: "{{ admin_user }}"
local_user_ssh_public_key: "/home/{{ local_user_account }}/.ssh/id_rsa.pub"
ssh_ocp4_public_key: "{{ lookup('file', local_user_ssh_public_key) }}"
# Working dir for OCP install
installation_working_dir: "{{ project_dir }}"
# location of your openshift pull secret
pull_secret: "{{ installation_working_dir }}/openshift-pull-secret.txt"

#############################################
# Disconnected or pull through mirror install
#
# These settings tells the installer to setup a
# pull through caching registry. This will allow
# for speeder cluster redployments. The role 
# ocp4-pullthrough-proxy call some of these vars.

additional_trust_bundle: ""
image_content_sources: ""

# This sets up a local registry that caches the pull of OCP containers
generated_pull_secret: "{{ installation_working_dir }}/generated_pullsecret.json"

#################################
# values for virt-install scripts
# used to deploy the RHCOS nodes

# This is for generating the virt-install-coreos.j2 for deployment
# of the RHCOS vms. Use this if the node has multiple nics and you need
# to specefiy the one that wil be able to download the rhcos-live-rootfs.x86_64.img.
node_primary_nic: ""

###############
# General vars
# This accepts ocp4 or okd4, howver this vars
# file is for deploying ocp4 and this should not be changed.
ocp4_okd4: ocp4

# OpenShift RH console
openshift_hosted_console_http: "https://console.redhat.com/openshift"

# OpenShift installer directory
openshift_install_folder: ocp4

# Set to false to not create the install-config
deploy_ocp4_configs: yes

# Directory to store k8s object config files
openshift_object_configs_files: "{{ openshift_install_dir }}/object-configs"

# Your openshift cluster url
openshift_url: "https://ctrlplane-0.{{ cluster_name }}.{{ ocp4_cluster_domain }}:6443"
openshift_install_dir: "{{ installation_working_dir }}/{{ openshift_install_folder }}"
ignition_files_dir: "{{ openshift_install_dir }}"
virtinstall_dir: "{{ installation_working_dir }}/rhcos-install"

dns_teardown: false
product: "{{ openshift_product }}"

ocp_client_cmd: /usr/local/bin/oc

########################
# NFS Persistent Storage
#nfs_server_ip: '192.168.50.1"
nfs_server_ip:  "{{ kvm_host_ip }}"
nfs_client_subnet: "{{ ocp4_subnet }}/24"
provision_nfs_client_provisoner: true      # deploys the nfs provision
configure_nfs_storage: yes  # set to no to skip deploying nfs storage
provision_nfs_server: true  # set to true to setup a nfs server
nfs_server_directory_path: /ocp4-nfs
openshift_object_configs_files_dir: "{{ openshift_install_dir }}/object-configs"
nfs_registry_pvc_object_file: "{{ openshift_object_configs_files }}/registry-pvc.yaml"
nfs_provisioner_sc_object_file: "{{ openshift_object_configs_files }}/nfs-provisioner-sc.yaml"
nfs_provisioner_rbac_object_file: "{{ openshift_object_configs_files }}/nfs-provisioner-rbac.yaml"
nfs_provisioner_deployment_file: "{{ openshift_object_configs_files }}/nfs-provisioner-deployment.yaml"
nfs_registry_pv_object_file: "{{ openshift_object_configs_files }}/registry-pv.yaml"

##############################
# OCS Persistent storage
configure_openshift_storage: no
openshift_storage_vd_size: 10
compute_ocs_size: 300
monpod_disk_size: "{{ compute_vdb_size }}"
osdvolume_disk_size: "{{ monpod_disk_size }}"

#################################
# Local persistent storage

# this adds several more disk to the compute nodes
compute_local_storage: no

localstorage_version: "{{ ocp4_majorversion }}"
localstorage_filesystem: no
localstorage_block: no

####################
# DNS & IdM info
internal_domain_name: "{{ domain }}"
external_domain_name: "{{ domain }}"
idm_server_shortname: "{{ idm_hostname }}"
idm_server_ipaddr: "{{ idm_server_ip }}"
idm_server_fqdn: "{{ ipa_host }}"
user_idm_admin: "{{ idm_admin_user }}"
user_idm_password: "{{ idm_admin_pwd }}"
ocp4_cluster_domain: "{{ ocp4_subdomain }}.{{ domain }}"
idm_dns_forward_zone: "{{ ocp4_cluster_domain }}"
idm_dns_reverse_zone: "50.168.192.in-addr.arpa."
dns_wildcard: "*.apps.{{ cluster_name }}"

##########################################
# OpenShift RHCOS and Installer requirements

# OpenShift Download URL
openshift_mirror: "https://mirror.openshift.com/pub/openshift-v4/x86_64/dependencies/rhcos/{{ ocp4_ystream_release }}/{{ ocp4_image }}"

# OpenShift Cli Download URL 
ocp4_release_url: "https://mirror.openshift.com/pub/openshift-v4/clients/ocp/{{ ocp4_client_version }}"

# OpenShift Dependencies
coreos_installer_kernel: "rhcos-live-kernel-x86_64"
coreos_installer_initramfs: "rhcos-live-initramfs.x86_64.img"
coreos_metal_bios: "rhcos-metal.x86_64.raw.gz"


#######################
# Configure Network 
libvirt_network_name: qubinat 
# set to qubinet for external network and set use_external_bridge: false
use_external_bridge: false
external_bridge_network: qubinet
old_libvirt_net: qbn # this was ocp4 need to see what to do with this
libvirt_network_mode: nat
libivrt_network_domain: "{{ cluster_name }}.{{ ocp4_subdomain }}.{{ domain }}"
listen_address: "{{ kvm_host_ip }}"
lb_name: "{{ ocp4_lb_container }}"
dns_domain: "{{ domain }}"
dns_server_ip: "{{ idm_server_ip }}"
nat_gateway: "192.168.50.1"
ocp4_subnet: "192.168.50.0"
ocp4_lb_container: qbn-lb
## Host name for the cluster nodes
hostname_prefix: "{{ instance_prefix }}-ocp4"
bootstrap_node_name: "{{ hostname_prefix }}-bootstrap"
bootstrap_octet: '2'
api_int_octet: '1'
api_octet: '1'
ctrlplane_ip_octet: 10
compute_ip_octet: 20
storage_ip_octet: 30
bootstrap_node_ip: "192.168.50.2"
ctrlplane_node_name: "{{ hostname_prefix }}-ctrlplane"
compute_node_name: "{{ hostname_prefix }}-compute"

#####################
# Bootstrap Webserver

rhcos_ignition_url: "http://{{ bootstrap_webserver_ip }}:8080/pub/{{ ocp4_dependencies_version }}/ignitions"
rhcos_ignition: "{{ rhcos_ignition_url}}/{{ vm_type }}.ign"
rhcos_metal_bios: "http://{{ bootstrap_webserver_ip }}:8080/pub/{{ ocp4_dependencies_version }}/images/{{ coreos_metal_bios }}"
rhcos_webserver_img_name: rhcos-webserver
coreos_tmp_dir: /tmp/build_coreos_container
webserver_directory: /opt/qubinode_webserver
ocp4_release_dir: "{{ ocp4_release }}"
podman_webserver: qbn-httpd
dest_ignitions_web_directory: "{{ webserver_directory }}/{{ ocp4_dependencies_version }}/ignitions/"
webserver_dependencies: "{{ webserver_directory }}/{{ ocp4_dependencies_version }}"
webserver_images: "{{ webserver_directory }}/{{ ocp4_dependencies_version }}/images"


######################################
# OCP Nodes Size Defaults
compute_count_update: none
bootstrap_hd_size: 120
bootstrap_mem_size: 16192
bootstrap_vcpu: 4

# Values for minimal deployment
min_ctrlplane_count: 3
min_compute_count: 1
min_vcpu: 4
min_mem: 10240

# OCP4 instance sizes
ocp4_instances:
  - name: "{{ hostname_prefix }}-ctrlplane"
    hd_size: "{{ ctrlplane_hd_size }}G"
    memory_size: "{{ ctrlplane_mem_size }}"
    cpu_size: "{{ ctrlplane_vcpu }}"
    extra_storage:
      - size: "{{ ctrlplane_vdb_size }}"
        enable: false
        name: vdb
      - size: "{{ ctrlplane_vdc_size }}"
        enable: false
        name: vdc
    qty: "{{ ctrlplane_count }}"
    vm_type: master
    ip_octet: "{{ ctrlplane_ip_octet }}"
  - name: "{{ hostname_prefix }}-compute"
    hd_size: "{{ compute_hd_size }}G"
    memory_size: "{{ compute_mem_size }}"
    cpu_size: "{{ compute_vcpu }}"
    extra_storage:
      - size: "{{ compute_vdb_size }}G"
        name: vdb
        enable: "{{ compute_local_storage }}"
      - size: "{{ compute_vdc_size }}G"
        name: vdc
        enable: "{{ compute_local_storage }}"
      - size: "{{ openshift_storage_vd_size }}G"
        name: vdd
        enable: "{{ configure_openshift_storage }}"
      - size: "{{ openshift_storage_vd_size }}G"
        name: vde
        enable: "{{ configure_openshift_storage }}"
      - size: "{{ openshift_storage_vd_size }}G"
        name: vdf
        enable: "{{ configure_openshift_storage }}"
      - size: "{{ openshift_storage_vd_size }}G"
        name: vdg
        enable: "{{ configure_openshift_storage }}"
      - size: "{{ openshift_storage_vd_size }}G"
        name: vdh
        enable: "{{ configure_openshift_storage }}"
      - size: "{{ openshift_storage_vd_size }}G"
        name: vdi
        enable: "{{ configure_openshift_storage }}"
      - size: "{{ openshift_storage_vd_size }}G"
        name: vdj
        enable: "{{ configure_openshift_storage }}"
      - size: "{{ openshift_storage_vd_size }}G"
        name: vdk
        enable: "{{ configure_openshift_storage }}"
      - size: "{{ openshift_storage_vd_size }}G"
        name: vdl
        enable: "{{ configure_openshift_storage }}"
      - size: "{{ compute_ocs_size }}G"
        name: vdm
        enable: "{{ configure_openshift_storage }}"
    qty: "{{ compute_count }}"
    vm_type: worker
    ip_octet: "{{ compute_ip_octet }}"
  - name: "{{ hostname_prefix }}-bootstrap"
    hd_size: "{{ bootstrap_hd_size }}G"
    memory_size: "{{ bootstrap_mem_size }}"
    cpu_size: "{{ bootstrap_vcpu }}"
    extra_storage:
      - size: ""
        name: vdb
        enable: false
      - size: ""
        name: vdc
        enable: false
    qty: 1
    vm_type: bootstrap
    ip_octet: 30
